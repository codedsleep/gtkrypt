{
  "version": 3,
  "sources": ["../../tests/harness.ts", "../../src/util/i18n.ts", "../../src/models/errors.ts", "../../tests/unit/errors.test.ts"],
  "sourcesContent": ["/**\n * Minimal GJS test harness with assertion helpers.\n *\n * Each test file imports from this module, runs assertions, and\n * calls `report()` at the end. Non-zero exit on any failure.\n */\n\nlet _passed = 0;\nlet _failed = 0;\nconst _errors: string[] = [];\n\nexport function assert(condition: boolean, message: string): void {\n  if (condition) {\n    _passed++;\n  } else {\n    _failed++;\n    _errors.push(`  FAIL: ${message}`);\n  }\n}\n\nexport function assertEqual<T>(actual: T, expected: T, message: string): void {\n  if (actual === expected) {\n    _passed++;\n  } else {\n    _failed++;\n    _errors.push(`  FAIL: ${message}\\n    expected: ${String(expected)}\\n    actual:   ${String(actual)}`);\n  }\n}\n\nexport function assertDeepEqual(actual: Uint8Array, expected: Uint8Array, message: string): void {\n  if (actual.length !== expected.length) {\n    _failed++;\n    _errors.push(`  FAIL: ${message}\\n    length mismatch: expected ${expected.length}, got ${actual.length}`);\n    return;\n  }\n  for (let i = 0; i < actual.length; i++) {\n    if (actual[i] !== expected[i]) {\n      _failed++;\n      _errors.push(`  FAIL: ${message}\\n    byte ${i} differs: expected ${expected[i]}, got ${actual[i]}`);\n      return;\n    }\n  }\n  _passed++;\n}\n\nexport function assertThrows(fn: () => void, errorName: string, message: string): void {\n  try {\n    fn();\n    _failed++;\n    _errors.push(`  FAIL: ${message}\\n    expected ${errorName} to be thrown, but nothing was thrown`);\n  } catch (e: unknown) {\n    const err = e as { name?: string };\n    if (err.name === errorName) {\n      _passed++;\n    } else {\n      _failed++;\n      _errors.push(`  FAIL: ${message}\\n    expected ${errorName}, got ${err.name ?? String(e)}`);\n    }\n  }\n}\n\nexport function assertBigIntEqual(actual: bigint, expected: bigint, message: string): void {\n  if (actual === expected) {\n    _passed++;\n  } else {\n    _failed++;\n    _errors.push(`  FAIL: ${message}\\n    expected: ${String(expected)}\\n    actual:   ${String(actual)}`);\n  }\n}\n\nexport function report(suiteName: string): void {\n  if (_errors.length > 0) {\n    printerr(`\\n${suiteName}:`);\n    for (const err of _errors) {\n      printerr(err);\n    }\n  }\n  print(`${suiteName}: ${_passed} passed, ${_failed} failed`);\n  if (_failed > 0) {\n    imports.system.exit(1);\n  }\n}\n", "import GLib from \"gi://GLib\";\n\nconst domain = \"gtkrypt\";\n\nimports.gettext.bindtextdomain(domain, GLib.get_home_dir());\nimports.gettext.textdomain(domain);\n\nexport const _ = imports.gettext.gettext;\nexport const ngettext = imports.gettext.ngettext;\n", "/**\n * Typed error classes for gtkrypt.\n *\n * Every error that can surface to the user has a `userMessage` property\n * containing a human-readable string suitable for display in the UI.\n * The `name` property is set to the class name for reliable `instanceof`\n * checks and clear stack traces.\n */\n\nimport { _ } from \"../util/i18n.js\";\n\n/** Base error class for all gtkrypt errors. */\nexport class GtkryptError extends Error {\n  public readonly userMessage: string;\n\n  constructor(message: string, userMessage: string) {\n    super(message);\n    this.name = \"GtkryptError\";\n    this.userMessage = userMessage;\n  }\n}\n\n/** The passphrase did not match or the file integrity check failed. */\nexport class WrongPassphraseError extends GtkryptError {\n  constructor(message = \"Wrong passphrase or integrity check failed\") {\n    super(message, _(\"Incorrect passphrase or file corrupted.\"));\n    this.name = \"WrongPassphraseError\";\n  }\n}\n\n/** The file is not a valid `.gtkrypt` container or has been corrupted. */\nexport class CorruptFileError extends GtkryptError {\n  constructor(message = \"Corrupt or unrecognized file format\") {\n    super(message, _(\"Not a gtkrypt file or file is corrupted.\"));\n    this.name = \"CorruptFileError\";\n  }\n}\n\n/** The container version is newer than this build understands. */\nexport class UnsupportedVersionError extends GtkryptError {\n  constructor(message = \"Unsupported container version\") {\n    super(message, _(\"This file was created with a newer version of gtkrypt.\"));\n    this.name = \"UnsupportedVersionError\";\n  }\n}\n\n/** The application lacks write permission to the target directory. */\nexport class PermissionError extends GtkryptError {\n  constructor(message = \"Permission denied\") {\n    super(message, _(\"No permission to write to the target directory.\"));\n    this.name = \"PermissionError\";\n  }\n}\n\n/** The user cancelled the operation. This is a silent error. */\nexport class CancelledError extends GtkryptError {\n  constructor(message = \"Operation cancelled\") {\n    super(message, \"\");\n    this.name = \"CancelledError\";\n  }\n}\n\n/** An unexpected internal error in the crypto backend. */\nexport class InternalCryptoError extends GtkryptError {\n  constructor(message = \"Internal crypto error\") {\n    super(message, _(\"An internal error occurred. Please report this bug.\"));\n    this.name = \"InternalCryptoError\";\n  }\n}\n", "/**\n * Unit tests for gtkrypt error classes.\n *\n * Validates that each error subclass has the correct name, userMessage,\n * inheritance chain, and message pass-through behavior.\n *\n * SCOPE.md 7.6 -- error classes and exit code mapping.\n */\n\nimport { assert, assertEqual, report } from \"../harness.js\";\nimport {\n  GtkryptError,\n  WrongPassphraseError,\n  CorruptFileError,\n  UnsupportedVersionError,\n  PermissionError,\n  CancelledError,\n  InternalCryptoError,\n} from \"../../src/models/errors.js\";\n\n// ---------------------------------------------------------------------------\n// 1. WrongPassphraseError\n// ---------------------------------------------------------------------------\n\nconst wrongPass = new WrongPassphraseError();\nassertEqual(wrongPass.name, \"WrongPassphraseError\", \"WrongPassphraseError.name\");\nassert(wrongPass.userMessage.length > 0, \"WrongPassphraseError.userMessage is non-empty\");\n\n// ---------------------------------------------------------------------------\n// 2. CorruptFileError\n// ---------------------------------------------------------------------------\n\nconst corrupt = new CorruptFileError();\nassertEqual(corrupt.name, \"CorruptFileError\", \"CorruptFileError.name\");\nassert(corrupt.userMessage.length > 0, \"CorruptFileError.userMessage is non-empty\");\n\n// ---------------------------------------------------------------------------\n// 3. UnsupportedVersionError\n// ---------------------------------------------------------------------------\n\nconst unsupported = new UnsupportedVersionError();\nassertEqual(unsupported.name, \"UnsupportedVersionError\", \"UnsupportedVersionError.name\");\nassert(unsupported.userMessage.length > 0, \"UnsupportedVersionError.userMessage is non-empty\");\n\n// ---------------------------------------------------------------------------\n// 4. PermissionError\n// ---------------------------------------------------------------------------\n\nconst perm = new PermissionError();\nassertEqual(perm.name, \"PermissionError\", \"PermissionError.name\");\nassert(perm.userMessage.length > 0, \"PermissionError.userMessage is non-empty\");\n\n// ---------------------------------------------------------------------------\n// 5. CancelledError (silent -- empty userMessage)\n// ---------------------------------------------------------------------------\n\nconst cancelled = new CancelledError();\nassertEqual(cancelled.name, \"CancelledError\", \"CancelledError.name\");\nassertEqual(cancelled.userMessage, \"\", \"CancelledError.userMessage is empty (silent)\");\n\n// ---------------------------------------------------------------------------\n// 6. InternalCryptoError\n// ---------------------------------------------------------------------------\n\nconst internal = new InternalCryptoError();\nassertEqual(internal.name, \"InternalCryptoError\", \"InternalCryptoError.name\");\nassert(internal.userMessage.length > 0, \"InternalCryptoError.userMessage is non-empty\");\n\n// ---------------------------------------------------------------------------\n// 7. All errors are instances of GtkryptError\n// ---------------------------------------------------------------------------\n\nassert(wrongPass instanceof GtkryptError, \"WrongPassphraseError instanceof GtkryptError\");\nassert(corrupt instanceof GtkryptError, \"CorruptFileError instanceof GtkryptError\");\nassert(unsupported instanceof GtkryptError, \"UnsupportedVersionError instanceof GtkryptError\");\nassert(perm instanceof GtkryptError, \"PermissionError instanceof GtkryptError\");\nassert(cancelled instanceof GtkryptError, \"CancelledError instanceof GtkryptError\");\nassert(internal instanceof GtkryptError, \"InternalCryptoError instanceof GtkryptError\");\n\n// ---------------------------------------------------------------------------\n// 8. All errors are instances of Error\n// ---------------------------------------------------------------------------\n\nassert(wrongPass instanceof Error, \"WrongPassphraseError instanceof Error\");\nassert(corrupt instanceof Error, \"CorruptFileError instanceof Error\");\nassert(unsupported instanceof Error, \"UnsupportedVersionError instanceof Error\");\nassert(perm instanceof Error, \"PermissionError instanceof Error\");\nassert(cancelled instanceof Error, \"CancelledError instanceof Error\");\nassert(internal instanceof Error, \"InternalCryptoError instanceof Error\");\n\n// GtkryptError itself is also an Error\nconst base = new GtkryptError(\"test\", \"test msg\");\nassert(base instanceof Error, \"GtkryptError instanceof Error\");\nassertEqual(base.name, \"GtkryptError\", \"GtkryptError.name\");\n\n// ---------------------------------------------------------------------------\n// 9. Custom messages pass through to the message property\n// ---------------------------------------------------------------------------\n\nconst customWrong = new WrongPassphraseError(\"custom wrong passphrase detail\");\nassertEqual(\n  customWrong.message,\n  \"custom wrong passphrase detail\",\n  \"WrongPassphraseError custom message passes through\",\n);\n\nconst customCorrupt = new CorruptFileError(\"custom corrupt detail\");\nassertEqual(\n  customCorrupt.message,\n  \"custom corrupt detail\",\n  \"CorruptFileError custom message passes through\",\n);\n\nconst customUnsupported = new UnsupportedVersionError(\"custom version detail\");\nassertEqual(\n  customUnsupported.message,\n  \"custom version detail\",\n  \"UnsupportedVersionError custom message passes through\",\n);\n\nconst customPerm = new PermissionError(\"custom permission detail\");\nassertEqual(\n  customPerm.message,\n  \"custom permission detail\",\n  \"PermissionError custom message passes through\",\n);\n\nconst customCancelled = new CancelledError(\"custom cancel detail\");\nassertEqual(\n  customCancelled.message,\n  \"custom cancel detail\",\n  \"CancelledError custom message passes through\",\n);\n\nconst customInternal = new InternalCryptoError(\"custom internal detail\");\nassertEqual(\n  customInternal.message,\n  \"custom internal detail\",\n  \"InternalCryptoError custom message passes through\",\n);\n\n// Also verify default messages are set when no argument is passed\nassertEqual(\n  wrongPass.message,\n  \"Wrong passphrase or integrity check failed\",\n  \"WrongPassphraseError default message\",\n);\nassertEqual(\n  corrupt.message,\n  \"Corrupt or unrecognized file format\",\n  \"CorruptFileError default message\",\n);\nassertEqual(\n  unsupported.message,\n  \"Unsupported container version\",\n  \"UnsupportedVersionError default message\",\n);\nassertEqual(\n  perm.message,\n  \"Permission denied\",\n  \"PermissionError default message\",\n);\nassertEqual(\n  cancelled.message,\n  \"Operation cancelled\",\n  \"CancelledError default message\",\n);\nassertEqual(\n  internal.message,\n  \"Internal crypto error\",\n  \"InternalCryptoError default message\",\n);\n\n// ---------------------------------------------------------------------------\n// Report\n// ---------------------------------------------------------------------------\n\nreport(\"errors\");\n"],
  "mappings": "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",
  "names": []
}
